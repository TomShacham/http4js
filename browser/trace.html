<div id='main'></div>

<script>
function drawHtml(zipkinTrace) {
      const topLevelRequestStartTime = zipkinTrace.start;

      const orderedSpans = [zipkinTrace].reduce((orderedList, span) => {
          pushChild(span);
          return orderedList;

          function pushChild(span) {
              const child = {start: span.start, end: span.end, spanId: span.spanId, timeTaken: span.timeTaken};
              orderedList.push(child);
              if (span.children.length > 0) span.children.map(child => pushChild(child));
          }
      }, []);

      const topLevelRequest = drawChild(orderedSpans[0]);
      orderedSpans.slice(1).map(span => {
         topLevelRequest.appendChild(drawChild(span));
      });
      return topLevelRequest;

      function drawChild(child) {
          const el = document.createElement('div');
          el.style.backgroundColor = 'lightgreen';
          el.style.flex = 'column';
          el.style.position = 'relative';
          el.style.left = Math.floor(1024*(child.start - topLevelRequestStartTime)/zipkinTrace.timeTaken) + 'px';
          el.style.width = 1024*(child.end - child.start)/zipkinTrace.timeTaken + 'px';
          el.style.height = '25px';
          el.innerText = 'start: ' + child.start + ' end: ' + child.end + ' span: ' + child.spanId;
          return el;
      }

  }

const trace = {
  "children": [
    {
      "children": [],
      "end": 3,
      "parentId": 1,
      "spanId": 3,
      "start": 2,
      "timeTaken": 1,
      "traceId": 2
    },
    {
      "children": [
        {
          "children": [],
          "end": 6,
          "parentId": 4,
          "spanId": 5,
          "start": 5,
          "timeTaken": 1,
          "traceId": 2
        }
      ],
      "end": 7,
      "parentId": 1,
      "spanId": 4,
      "start": 4,
      "timeTaken": 3,
      "traceId": 2
    }
  ],
  "end": 8,
  "parentId": undefined,
  "spanId": 1,
  "start": 1,
  "timeTaken": 7,
  "traceId": 2
};

document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('main').appendChild(drawHtml(trace));
});



</script>